/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Label Recognizer JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2022, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 2.2.4 (js 20220414)
 * @fileoverview Dynamsoft JavaScript Library for Label Recognizer
 * More info on DLR JS: https://www.dynamsoft.com/label-recognizer/sdk-javascript/
 */
!function(){"use strict";(()=>{const e=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name);let t;e&&(global.self=global),e&&(t=require("worker_threads"));let r,n,a,o,i,s,c,u,l=e?t.parentPort:self,f="dlr",d="LabelRecognizerWasm",y=0,g=0;let h,m=new Promise((e=>{h=e})),p=!1,b=async e=>{await m,s=e.trial,c=e.msg,Module[d].init(JSON.stringify(e))},v=()=>Module[d].getMinExpireTime(),w=()=>Module[d].getMaxExpireTime(),A={};const S=async(t,r)=>{A[t]||(r?"@engineResourcePath"===r&&(r=n):r="",r+=t+"/",A[t]=(async()=>{try{let n,a,o;l.postMessage({type:"event",body:{type:"resourcesLoadStarted",resourcesPath:r+t+".data"}});const i=new TextDecoder;if(e)n=await(async e=>{const t=require("fs/promises");return await t.readFile(e)})(r+t+".data");else{const e=await new Promise(((e,n)=>{const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onload=()=>{e({ok:!0,arrayBuffer:()=>a.response})},a.onerror=a.timeout=a.onabort=()=>{e({ok:!1,status:a.status})};let o=Date.now();a.onprogress=e=>{if(e.lengthComputable){const n=Date.now();o+500<n&&(l.postMessage({type:"event",body:{type:"resourcesLoadProgress",loaded:e.loaded,total:e.total,resourcesPath:r+t+".data"}}),o=n)}},a.open("GET",r+t+".data",!0),a.send()}));if(!e.ok)throw new Error(`Network error. Status: ${e.status}.`);n=await e.arrayBuffer()}{if(!i.decode(new Uint8Array(n,0,8)).startsWith("DLR_MDL"))throw new Error("Model data type incorrect.");let e=0;const t=new Uint8Array(n,8,8);for(let r=7;r>=0;--r)e=256*e+t[r];const r=i.decode(new Uint8Array(n,16,e));a=JSON.parse(r),o=16+e}let s=e=>{const t=a[e];if(!t)throw new Error("File name not found.");return new Uint8Array(n,o+t[0],t[1])},c=JSON.parse(i.decode(s(t+".config.json")));const u=c.mainModel,f=c.assistModels,y=c.modelFilter;{const e=s(u+".prototxt"),r=s(u+".txt"),n=s(u+".caffemodel");Module[d].appendCaffeModelBuffer(t,e,r,n)}if(f)for(let e of f){const r=t+e,n=u+e,a=s(n+".prototxt"),o=s(n+".txt"),i=s(n+".caffemodel");Module[d].appendCaffeModelBuffer(r,a,o,i)}return y&&Module[d].appendModelFilterFileBuffer(t,s(y+".txt")),A[t]=!0,l.postMessage({type:"event",body:{type:"resourcesLoaded",resourcesPath:r+t+".data"}}),!0}catch(e){throw delete A[t],e}})()),await A[t]},M="(P[A-Z<][A-Z<]{3}([A-Z<]{0,35}[A-Z]{1,3}[(<<)][A-Z]{1,3}[A-Z<]{0,35}<{0,35}){(39)}){(44)}|([A-Z0-9<]{9}[0-9][A-Z<]{3}[0-9]{2}[(01-12)][(01-31)][0-9][MF<][0-9]{2}[(01-12)][(01-31)][0-9][A-Z0-9<]{14}[0-9<][0-9]){(44)}",_="(V[A-Z<][A-Z<]{3}([A-Z<]{0,27}[A-Z]{1,3}[(<<)][A-Z]{1,3}[A-Z<]{0,27}){(31)}){(36)}|([A-Z0-9<]{9}[0-9][A-Z<]{3}[0-9]{2}[(01-12)][(01-31)][0-9][MF<][0-9]{2}[(01-12)][(01-31)][0-9][A-Z0-9<]{8}){(36)}|(V[A-Z<][A-Z<]{3}([A-Z<]{0,35}[A-Z]{1,3}[(<<)][A-Z]{1,3}[A-Z<]{0,35}<{0,35}){(39)}){(44)}|([A-Z0-9<]{9}[0-9][A-Z<]{3}[0-9]{2}[(01-12)][(01-31)][0-9][MF<][0-9]{2}[(01-12)][(01-31)][0-9][A-Z0-9<]{14}[A-Z0-9<]{2}){(44)}",x="([ACI][A-Z<][A-Z<]{3}[A-Z0-9<]{9}[0-9][A-Z0-9<]{15}){(30)}|([0-9]{2}[(01-12)][(01-31)][0-9][MF<][0-9]{2}[(01-12)][(01-31)][0-9][A-Z<]{3}[A-Z0-9<]{11}[0-9]){(30)}|([A-Z<]{0,26}[A-Z]{1,3}[(<<)][A-Z]{1,3}[A-Z<]{0,26}<{0,26}){(30)}|([ACIV][A-Z<][A-Z<]{3}([A-Z<]{0,27}[A-Z]{1,3}[(<<)][A-Z]{1,3}[A-Z<]{0,27}){(31)}){(36)}|([A-Z0-9<]{9}[0-9][A-Z<]{3}[0-9]{2}[(01-12)][(01-31)][0-9][MF<][0-9]{2}[(01-12)][(01-31)][0-9][A-Z0-9<]{8}){(36)}|([PV][A-Z<][A-Z<]{3}([A-Z<]{0,35}[A-Z]{1,3}[(<<)][A-Z]{1,3}[A-Z<]{0,35}<{0,35}){(39)}){(44)}|([A-Z0-9<]{9}[0-9][A-Z<]{3}[0-9]{2}[(01-12)][(01-31)][0-9][MF<][0-9]{2}[(01-12)][(01-31)][0-9][A-Z0-9<]{14}[A-Z0-9<]{2}){(44)}",N=e=>{e.CharacterModelArray[0].Name="VIN";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="VIN",t.GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},t.BinarizationModes[0].Mode="BM_LOCAL_BLOCK",t.BinarizationModes[0].EnableFillBinaryVacancy=0,t.LineStringLengthRange=[14,20],t.LetterHeightRange=[10,1e3,1],e.TextAreaArray[0].CharacterModelName="VIN",e.TextAreaArray[0].GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},e.TextAreaArray[0].BinarizationModes[0].Mode="BM_LOCAL_BLOCK",e.TextAreaArray[0].BinarizationModes[0].EnableFillBinaryVacancy=0,e.TextAreaArray[0].LineStringLengthRange=[14,20],e.TextAreaArray[0].LetterHeightRange=[10,1e3,1]};let T=new Map,L=0,R=async function(t){const m=t.data?t.data:t,R=m.id,E=m.instanceID,O=m.body;switch(i&&"recognizeByBuffer"==m.type&&await u.c(),m.type){case"loadWasm":try{r=m.bd,n=m.engineResourcePath,a=m.version;let t=m.dm,y=m.lcs;i=m.brtk;let g,A=m.bptk;(async()=>{if(p)throw"can't load wasm twice";p=!0,k("wasm loading..."),o=Date.now(),await new Promise((t=>{if(self.KModule=self.Module={locateFile:function(e){return"libDynamsoftLabelRecognizer.wasm"==e?n+f+"-"+a+".wasm":n+e},print:e=>{k(e)},printErr:e=>{console.error(e),k(e)},onRuntimeInitialized:async function(){k("wasm initialized, cost "+(Date.now()-o)+" ms"),e||(Module=KModule),h(),t()}},e){let e=Module;Module=require("./dlr-"+a+".wasm.js");for(let t in e)Module[t]=e[t]}else importScripts(n+f+"-"+a+".wasm.js")}))})();let S=async()=>{try{let e=e=>{const t=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name);let r,n,a,o,i,s,c,u,l,f,d,y,g,h,m,p,b,v,w,A,S,M,_,x,N=e.dwt?Dynamsoft.Lib.Promise:self.Promise,T=e.btoa||(t?global.btoa||(e=>Buffer.from(e,"binary").toString("base64")):self.btoa),L=e.atob||(t?global.atob||(e=>Buffer.from(e,"base64").toString("binary")):self.atob),R=e.product,k=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"],C=!1,I=N.resolve(),E=e.lf,O=e.log||(()=>{}),D=e.dwt?t=>{try{e.debugLog&&e.debugLog(t)}catch(e){}}:e.debugLog||(()=>{}),B=e.fol,j=e.sutlcb;Date.prototype.kUtilFormat=function(e){var t={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("000"+t[r]).substr(("000"+t[r]).length-RegExp.$1.length)));return e};let F,Z,U,z,P=e=>e.join(""),H={a:[80,88,27,82,145,164,199,211],b:[187,87,89,128,150,44,190,213],c:[89,51,74,53,99,72,82,118],d:[99,181,118,158,215,103,76,117],e:[99,51,86,105,100,71,120,108],f:[97,87,49,119,98,51,74,48,83,50,86,53],g:[81,85,86,84,76,85,100,68,84,81,32,32],h:[90,87,53,106,99,110,108,119,100,65,32,32],i:[90,71,86,106,99,110,108,119,100,65,32,32],j:[97,88,89,32],k:[29,83,122,137,5,180,157,114],l:[100,71,70,110,84,71,86,117,90,51,82,111]},J=()=>self[P(H.c)][P(H.e)][P(H.f)]("raw",new Uint8Array(H.a.concat(H.b,H.d,H.k)),P(H.g),!0,[P(H.h),P(H.i)]),q=e.fdaa||(async e=>{if(self[P(H.c)]&&self[P(H.c)][P(H.e)]&&self[P(H.c)][P(H.e)][P(H.f)]){let t=L(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;++e)r[e]=t.charCodeAt(e);let n=r.subarray(0,12),a=r.subarray(n.length);x||(x=await J());let o=await self[P(H.c)][P(H.e)][P(H.i)]({name:P(H.g),[P(H.j)]:n,[P(H.l)]:128},x,a);return String.fromCharCode.apply(null,new Uint8Array(o))}}),G=e.feab||(async e=>{if(self[P(H.c)]&&self[P(H.c)][P(H.e)]&&self[P(H.c)][P(H.e)][P(H.f)]){let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);let r=self.crypto.getRandomValues(new Uint8Array(12));x||(x=await J());let n=await self[P(H.c)][P(H.e)][P(H.h)]({name:P(H.g),[P(H.j)]:r,[P(H.l)]:128},x,t),a=new Uint8Array(n),o=new Uint8Array(r.length+a.length);return o.set(r),o.set(a,r.length),T(String.fromCharCode.apply(null,o))}}),W=e=>L(L(e.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),V=e=>T(String.fromCharCode(97+25*Math.random())+T(e)).replace(/\+/g,"\n").replace(/=/g," "),K=()=>{if(F)return F;if(self.crypto){let e=new Uint8Array(36);self.crypto.getRandomValues(e);let t="";for(let r=0;r<36;++r){let n=e[r]%36;t+=n<10?n:String.fromCharCode(n+87)}return t}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},X="Failed to connect to the License Tracking Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information.",$="Failed to connect to the License Tracking Server: network timed out. Check your Internet connection or [contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.",Y="Failed to connect to the License Tracking Server: network timed out. Check your Internet connection or contact the site administrator for more information.",Q="Failed to connect to the License Tracking Server: network connection error. Check your Internet connection or [contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.",ee="Failed to connect to the License Tracking Server: network connection error. Check your Internet connection or contact the site administrator for more information.",te="Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again.",re=()=>{E||self.localforage||(t?(global.localforage=require("node-localstorage").LocalStorage,global.localforage.prototype.keys=function(){let e=[];for(let t=0;t<this.length;++t)e.push(this.key(t));return e},global.localforage.createInstance=function(e){return new E("./dynamsoftverify/"+e.name)}):function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=e()}}((function(){return function e(t,r,n){function a(i,s){if(!r[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[i]={exports:{}};t[i][0].call(l.exports,(function(e){return a(t[i][1][e]||e)}),l,l.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(e,t,r){(function(e){function r(){u=!0;for(var e,t,r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}u=!1}var n,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var o=0,i=new a(r),s=e.document.createTextNode("");i.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var c=new e.MessageChannel;c.port1.onmessage=r,n=function(){c.port2.postMessage(0)}}var u,l=[];t.exports=function(e){1!==l.push(e)||u||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){function n(){}function a(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,e!==n&&c(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function i(e,t,r){l((function(){var n;try{n=t(r)}catch(t){return f.reject(e,t)}n===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,n)}))}function s(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function c(e,t){function r(t){a||(a=!0,f.reject(e,t))}function n(t){a||(a=!0,f.resolve(e,t))}var a=!1,o=u((function(){t(n,r)}));"error"===o.status&&r(o.value)}function u(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var l=e(1),f={},d=["REJECTED"],y=["FULFILLED"],g=["PENDING"];t.exports=a,a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){if("function"!=typeof e&&this.state===y||"function"!=typeof t&&this.state===d)return this;var r=new this.constructor(n);return this.state!==g?i(r,this.state===y?e:t,this.outcome):this.queue.push(new o(r,e,t)),r},o.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){f.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)},f.resolve=function(e,t){var r=u(s,t);if("error"===r.status)return f.reject(e,r.value);var n=r.value;if(n)c(e,n);else{e.state=y,e.outcome=t;for(var a=-1,o=e.queue.length;++a<o;)e.queue[a].callFulfilled(t)}return e},f.reject=function(e,t){e.state=d,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},a.resolve=function(e){return e instanceof this?e:f.resolve(new this(n),e)},a.reject=function(e){var t=new this(n);return f.reject(t,e)},a.all=function(e){function t(e,t){r.resolve(e).then((function(e){i[t]=e,++s!==a||o||(o=!0,f.resolve(u,i))}),(function(e){o||(o=!0,f.reject(u,e))}))}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var a=e.length,o=!1;if(!a)return this.resolve([]);for(var i=new Array(a),s=0,c=-1,u=new this(n);++c<a;)t(e[c],c);return u},a.race=function(e){function t(e){r.resolve(e).then((function(e){o||(o=!0,f.resolve(s,e))}),(function(e){o||(o=!0,f.reject(s,e))}))}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var a=e.length,o=!1;if(!a)return this.resolve([]);for(var i=-1,s=new this(n);++i<a;)t(e[i]);return s}},{1:1}],3:[function(e,t,r){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function o(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function i(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function s(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function c(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),a=0;a<t;a++)n[a]=e.charCodeAt(a);return r}function u(e){return"boolean"==typeof F?B.resolve(F):function(e){return new B((function(t){var r=e.transaction(j,P),a=n([""]);r.objectStore(j).put(a,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return F=e}))}function l(e){var t=Z[e.name],r={};r.promise=new B((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function f(e){var t=Z[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function d(e,t){var r=Z[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function y(e,t){return new B((function(r,n){if(Z[e.name]=Z[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);l(e),e.db.close()}var a=[e.name];t&&a.push(e.version);var o=D.open.apply(D,a);t&&(o.onupgradeneeded=function(t){var r=o.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(j)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),n(o.error)},o.onsuccess=function(){r(o.result),f(e)}}))}function g(e){return y(e,!1)}function h(e){return y(e,!0)}function m(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,a=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function p(e){return n([c(L(e.data))],{type:e.type})}function b(e){return e&&e.__local_forage_encoded_blob}function v(e){var t=this,r=t._initReady().then((function(){var e=Z[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return o(r,e,e),r}function w(e,t,r,n){void 0===n&&(n=1);try{var a=e.db.transaction(e.storeName,t);r(null,a)}catch(a){if(n>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return B.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),h(e)})).then((function(){return function(e){l(e);for(var t=Z[e.name],r=t.forages,n=0;n<r.length;n++){var a=r[n];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,g(e).then((function(t){return e.db=t,m(e)?h(e):t})).then((function(n){e.db=t.db=n;for(var a=0;a<r.length;a++)r[a]._dbInfo.db=n})).catch((function(t){throw d(e,t),t}))}(e).then((function(){w(e,t,r,n-1)}))})).catch(r);r(a)}}function A(e){var t,r,n,a,o,i=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var u=new ArrayBuffer(i),l=new Uint8Array(u);for(t=0;t<s;t+=4)r=J.indexOf(e[t]),n=J.indexOf(e[t+1]),a=J.indexOf(e[t+2]),o=J.indexOf(e[t+3]),l[c++]=r<<2|n>>4,l[c++]=(15&n)<<4|a>>2,l[c++]=(3&a)<<6|63&o;return u}function S(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=J[r[t]>>2],n+=J[(3&r[t])<<4|r[t+1]>>4],n+=J[(15&r[t+1])<<2|r[t+2]>>6],n+=J[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function M(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function _(e,t,r,n,a,o){e.executeSql(r,n,a,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,i):M(e,t,(function(){e.executeSql(r,n,a,o)}),o)}),o):o(e,i)}),o)}function x(e,t,r,n){var o=this;e=i(e);var s=new B((function(a,i){o.ready().then((function(){void 0===t&&(t=null);var s=t,c=o._dbInfo;c.serializer.serialize(t,(function(t,u){u?i(u):c.db.transaction((function(r){_(r,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(s)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void a(x.apply(o,[e,s,r,n-1]));i(t)}}))}))})).catch(i)}));return a(s,r),s}function R(e){return new B((function(t,r){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(r,n){for(var a=[],o=0;o<n.rows.length;o++)a.push(n.rows.item(o).name);t({db:e,storeNames:a})}),(function(e,t){r(t)}))}),(function(e){r(e)}))}))}function k(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function C(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}function I(e,t){e[t]=function(){var r=arguments;return e.ready().then((function(){return e[t].apply(e,r)}))}}function E(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(ye(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();void 0===N&&e(3);var B=N,j="local-forage-detect-blob-support",F=void 0,Z={},U=Object.prototype.toString,z="readonly",P="readwrite",H={_driver:"asyncStorage",_initStorage:function(e){function t(){return B.resolve()}var r=this,n={db:null};if(e)for(var a in e)n[a]=e[a];var o=Z[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},Z[n.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=v);for(var i=[],s=0;s<o.forages.length;s++){var c=o.forages[s];c!==r&&i.push(c._initReady().catch(t))}var u=o.forages.slice(0);return B.all(i).then((function(){return n.db=o.db,g(n)})).then((function(e){return n.db=e,m(n,r._defaultConfig.version)?h(n):e})).then((function(e){n.db=o.db=e,r._dbInfo=n;for(var t=0;t<u.length;t++){var a=u[t];a!==r&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}}))},_support:function(){try{if(!D)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=new B((function(t,n){r.ready().then((function(){w(r._dbInfo,z,(function(a,o){if(a)return n(a);try{var i=o.objectStore(r._dbInfo.storeName).openCursor(),s=1;i.onsuccess=function(){var r=i.result;if(r){var n=r.value;b(n)&&(n=p(n));var a=e(n,r.key,s++);void 0!==a?t(a):r.continue()}else t()},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,t),n},getItem:function(e,t){var r=this;e=i(e);var n=new B((function(t,n){r.ready().then((function(){w(r._dbInfo,z,(function(a,o){if(a)return n(a);try{var i=o.objectStore(r._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),b(e)&&(e=p(e)),t(e)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,t),n},setItem:function(e,t,r){var n=this;e=i(e);var o=new B((function(r,a){var o;n.ready().then((function(){return o=n._dbInfo,"[object Blob]"===U.call(t)?u(o.db).then((function(e){return e?t:function(e){return new B((function(t,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=T(r.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)}))}(t)})):t})).then((function(t){w(n._dbInfo,P,(function(o,i){if(o)return a(o);try{var s=i.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),r(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return a(o,r),o},removeItem:function(e,t){var r=this;e=i(e);var n=new B((function(t,n){r.ready().then((function(){w(r._dbInfo,P,(function(a,o){if(a)return n(a);try{var i=o.objectStore(r._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(i.error)},o.onabort=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return a(n,t),n},clear:function(e){var t=this,r=new B((function(e,r){t.ready().then((function(){w(t._dbInfo,P,(function(n,a){if(n)return r(n);try{var o=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},length:function(e){var t=this,r=new B((function(e,r){t.ready().then((function(){w(t._dbInfo,z,(function(n,a){if(n)return r(n);try{var o=a.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},key:function(e,t){var r=this,n=new B((function(t,n){e<0?t(null):r.ready().then((function(){w(r._dbInfo,z,(function(a,o){if(a)return n(a);try{var i=o.objectStore(r._dbInfo.storeName),s=!1,c=i.openCursor();c.onsuccess=function(){var r=c.result;r?0===e||s?t(r.key):(s=!0,r.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,t),n},keys:function(e){var t=this,r=new B((function(e,r){t.ready().then((function(){w(t._dbInfo,z,(function(n,a){if(n)return r(n);try{var o=a.objectStore(t._dbInfo.storeName).openCursor(),i=[];o.onsuccess=function(){var t=o.result;t?(i.push(t.key),t.continue()):e(i)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,e),r},dropInstance:function(e,t){t=s.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,o=this;if(e.name){var i=e.name===r.name&&o._dbInfo.db,c=i?B.resolve(o._dbInfo.db):g(e).then((function(t){var r=Z[e.name],n=r.forages;r.db=t;for(var a=0;a<n.length;a++)n[a]._dbInfo.db=t;return t}));n=e.storeName?c.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;l(e);var n=Z[e.name],a=n.forages;t.close();for(var o=0;o<a.length;o++){var i=a[o];i._dbInfo.db=null,i._dbInfo.version=r}return new B((function(t,n){var a=D.open(e.name,r);a.onerror=function(e){a.result.close(),n(e)},a.onupgradeneeded=function(){a.result.deleteObjectStore(e.storeName)},a.onsuccess=function(){var e=a.result;e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<a.length;t++){var r=a[t];r._dbInfo.db=e,f(r._dbInfo)}})).catch((function(t){throw(d(e,t)||B.resolve()).catch((function(){})),t}))}})):c.then((function(t){l(e);var r=Z[e.name],n=r.forages;t.close();for(var a=0;a<n.length;a++)n[a]._dbInfo.db=null;return new B((function(t,r){var n=D.deleteDatabase(e.name);n.onerror=n.onblocked=function(e){var t=n.result;t&&t.close(),r(e)},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<n.length;t++)f(n[t]._dbInfo)})).catch((function(t){throw(d(e,t)||B.resolve()).catch((function(){})),t}))}))}else n=B.reject("Invalid arguments");return a(n,t),n}},J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q="~~local_forage_type~",G=/^~~local_forage_type~([^~]+)~/,W="__lfsc__:",V=W.length,K="arbf",X="blob",$="si08",Y="ui08",Q="uic8",ee="si16",te="si32",re="ur16",ne="ui32",ae="fl32",oe="fl64",ie=V+K.length,se=Object.prototype.toString,ce={serialize:function(e,t){var r="";if(e&&(r=se.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===se.call(e.buffer))){var n,a=W;e instanceof ArrayBuffer?(n=e,a+=K):(n=e.buffer,"[object Int8Array]"===r?a+=$:"[object Uint8Array]"===r?a+=Y:"[object Uint8ClampedArray]"===r?a+=Q:"[object Int16Array]"===r?a+=ee:"[object Uint16Array]"===r?a+=re:"[object Int32Array]"===r?a+=te:"[object Uint32Array]"===r?a+=ne:"[object Float32Array]"===r?a+=ae:"[object Float64Array]"===r?a+=oe:t(new Error("Failed to get type for BinaryArray"))),t(a+S(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r=q+e.type+"~"+S(this.result);t(W+X+r)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if(e.substring(0,V)!==W)return JSON.parse(e);var t,r=e.substring(ie),a=e.substring(V,ie);if(a===X&&G.test(r)){var o=r.match(G);t=o[1],r=r.substring(o[0].length)}var i=A(r);switch(a){case K:return i;case X:return n([i],{type:t});case $:return new Int8Array(i);case Y:return new Uint8Array(i);case Q:return new Uint8ClampedArray(i);case ee:return new Int16Array(i);case re:return new Uint16Array(i);case te:return new Int32Array(i);case ne:return new Uint32Array(i);case ae:return new Float32Array(i);case oe:return new Float64Array(i);default:throw new Error("Unkown type: "+a)}},stringToBuffer:A,bufferToString:S},ue={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var a=new B((function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction((function(a){M(a,r,(function(){t._dbInfo=r,e()}),(function(e,t){n(t)}))}),n)}));return r.serializer=ce,a},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,n=new B((function(t,n){r.ready().then((function(){var a=r._dbInfo;a.db.transaction((function(r){_(r,a,"SELECT * FROM "+a.storeName,[],(function(r,n){for(var o=n.rows,i=o.length,s=0;s<i;s++){var c=o.item(s),u=c.value;if(u&&(u=a.serializer.deserialize(u)),void 0!==(u=e(u,c.key,s+1)))return void t(u)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,t),n},getItem:function(e,t){var r=this;e=i(e);var n=new B((function(t,n){r.ready().then((function(){var a=r._dbInfo;a.db.transaction((function(r){_(r,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=a.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,t),n},setItem:function(e,t,r){return x.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=i(e);var n=new B((function(t,n){r.ready().then((function(){var a=r._dbInfo;a.db.transaction((function(r){_(r,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,t),n},clear:function(e){var t=this,r=new B((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){_(t,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},length:function(e){var t=this,r=new B((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){_(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(t,r){var n=r.rows.item(0).c;e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},key:function(e,t){var r=this,n=new B((function(t,n){r.ready().then((function(){var a=r._dbInfo;a.db.transaction((function(r){_(r,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,t),n},keys:function(e){var t=this,r=new B((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){_(t,n,"SELECT key FROM "+n.storeName,[],(function(t,r){for(var n=[],a=0;a<r.rows.length;a++)n.push(r.rows.item(a).key);e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,e),r},dropInstance:function(e,t){t=s.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,o=this;return n=e.name?new B((function(t){var n;n=e.name===r.name?o._dbInfo.db:openDatabase(e.name,"","",0),t(e.storeName?{db:n,storeNames:[e.storeName]}:R(n))})).then((function(e){return new B((function(t,r){e.db.transaction((function(n){function a(e){return new B((function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){r(t)}))}))}for(var o=[],i=0,s=e.storeNames.length;i<s;i++)o.push(a(e.storeNames[i]));B.all(o).then((function(){t()})).catch((function(e){r(e)}))}),(function(e){r(e)}))}))})):B.reject("Invalid arguments"),a(n,t),n}},le={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=k(e,this._defaultConfig),C()?(this._dbInfo=t,t.serializer=ce,B.resolve()):B.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=r.ready().then((function(){for(var t=r._dbInfo,n=t.keyPrefix,a=n.length,o=localStorage.length,i=1,s=0;s<o;s++){var c=localStorage.key(s);if(0===c.indexOf(n)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(a),i++)))return u}}}));return a(n,t),n},getItem:function(e,t){var r=this;e=i(e);var n=r.ready().then((function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return a(n,t),n},setItem:function(e,t,r){var n=this;e=i(e);var o=n.ready().then((function(){void 0===t&&(t=null);var r=t;return new B((function(a,o){var i=n._dbInfo;i.serializer.serialize(t,(function(t,n){if(n)o(n);else try{localStorage.setItem(i.keyPrefix+e,t),a(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return a(o,r),o},removeItem:function(e,t){var r=this;e=i(e);var n=r.ready().then((function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(n,t),n},clear:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return a(r,e),r},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var r=this,n=r.ready().then((function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return a(n,t),n},keys:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo,r=localStorage.length,n=[],a=0;a<r;a++){var o=localStorage.key(a);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n}));return a(r,e),r},dropInstance:function(e,t){if(t=s.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var n,o=this;return n=e.name?new B((function(t){t(e.storeName?k(e,o._defaultConfig):e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}})):B.reject("Invalid arguments"),a(n,t),n}},fe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},de=function(e,t){for(var r=e.length,n=0;n<r;){if(fe(e[n],t))return!0;n++}return!1},ye=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ge={},he={},me={INDEXEDDB:H,WEBSQL:ue,LOCALSTORAGE:le},pe=[me.INDEXEDDB._driver,me.WEBSQL._driver,me.LOCALSTORAGE._driver],be=["dropInstance"],ve=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(be),we={description:"",driver:pe.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},Ae=function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),me)if(me.hasOwnProperty(r)){var n=me[r],a=n._driver;this[r]=a,ge[a]||this.defineDriver(n)}this._defaultConfig=E({},we),this._config=E({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":O(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new B((function(t,r){try{var n=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(o);for(var i=ve.concat("_initStorage"),s=0,c=i.length;s<c;s++){var u=i[s];if((!de(be,u)||e[u])&&"function"!=typeof e[u])return void r(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=B.reject(t);return a(r,arguments[arguments.length-1]),r}},r=0,n=be.length;r<n;r++){var o=be[r];e[o]||(e[o]=t(o))}}();var l=function(r){ge[n]&&console.info("Redefining LocalForage driver: "+n),ge[n]=e,he[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(l,r):l(!!e._support):l(!0)}catch(e){r(e)}}));return o(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=ge[e]?B.resolve(ge[e]):B.reject(new Error("Driver not found."));return o(n,t,r),n},e.prototype.getSerializer=function(e){var t=B.resolve(ce);return o(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return o(r,e,e),r},e.prototype.setDriver=function(e,t,r){function n(){i._config.driver=i.driver()}function a(e){return i._extend(e),n(),i._ready=i._initStorage(i._config),i._ready}var i=this;ye(e)||(e=[e]);var s=this._getSupportedDrivers(e),c=null!==this._driverSet?this._driverSet.catch((function(){return B.resolve()})):B.resolve();return this._driverSet=c.then((function(){var e=s[0];return i._dbInfo=null,i._ready=null,i.getDriver(e).then((function(e){i._driver=e._driver,n(),i._wrapLibraryMethodsWithReady(),i._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var o=e[t];return t++,i._dbInfo=null,i._ready=null,i.getDriver(o).then(a).catch(r)}n();var s=new Error("No available storage method found.");return i._driverSet=B.reject(s),i._driverSet}()}}(s)}))})).catch((function(){n();var e=new Error("No available storage method found.");return i._driverSet=B.reject(e),i._driverSet})),o(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!he[e]},e.prototype._extend=function(e){E(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var a=e[r];this.supports(a)&&t.push(a)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=ve.length;e<t;e++)I(this,ve[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),Se=new Ae;t.exports=Se},{3:3}]},{},[4])(4)}))),E=E||self.localforage},ne=async()=>{re(),t&&(global.fetch=global.fetch||require("node-fetch"),global.crypto=global.crypto||require("crypto").webcrypto),P=e=>L(String.fromCharCode.apply(null,e).replace(/\n/g,"+").replace(/\s/g,"="));try{let e=await E.createInstance({name:R+"jshello"});await e.setItem(R+"jshello","available")}catch(e){throw e&&"No available storage method found."===e.message&&(e=new Error("Failed to access indexedDB. Our SDK stores the client's UUID in the browser's indexedDB for licensing purposes. Please make sure you are not in the private browsing mode or allow cookies in Browser Settings > Site Settings > Cookies.")),e}if(v=await E.createInstance({name:"dynamltsinfo"}),w=F?null:T(T("v2")+String.fromCharCode(c.charCodeAt(c.length/2)+1)+T(c)),A=T(String.fromCharCode(o.charCodeAt(0)+10)+T(R)+T(o)+a+T(""+s)),!F){try{let e=await v.getItem(w);e&&([u,h]=JSON.parse(await W(e)))}catch(e){}try{null==u&&(u=K())}catch(e){}}b=await E.createInstance({name:"dynamltsuns"+T(String.fromCharCode(o.charCodeAt(0)+10)+T(R)+T(o)+a+T(""+s))});try{i=await v.getItem(A)}catch(e){}},ae=async n=>{Z||(Z=(async()=>{try{let e={hs:"",pd:R,vm:a,dt:s||(t?"server":"browser"),ed:"javascript",cu:u,ad:c,os:JSON.stringify(l),fn:f};o&&(e=-1!=o.indexOf("-")?{...e,hs:o}:{...e,og:o});let r={};if(h&&!F){let e=await v.getItem(w);e&&([u,h]=JSON.parse(await W(e))),r["lts-time"]=h}d&&(e.sp=d),y&&(e.lm=y),g&&(e.cw=g);let m=await N.race([(async()=>{let t,a=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");h&&!F&&(v.setItem(w,await V(JSON.stringify([u,a]))),h=a);let s,c,l="auth/?ext="+encodeURIComponent(T(JSON.stringify(e))),f=!1,d=!1,y=async e=>{if(e&&!e.ok)try{let t=await e.text();if(t){s=t;let e=JSON.parse(t);e.errorCode&&(c=e,e.errorCode>100&&e.errorCode<200&&(i=null,f=!0,d=!0))}}catch(e){}};try{t=await N.race([fetch(k[0]+l,{headers:r,cache:n?"reload":"default",mode:"cors",timeout:1e4}),new N(((e,t)=>{setTimeout(t,1e4)}))]),await y(t)}catch(e){}if(!(h||t&&t.ok||f))try{t=await fetch(k[1]+l,{headers:r,mode:"cors",timeout:3e4}),await y(t)}catch(e){}if(!(h||t&&t.ok||f))try{t=await fetch(k[0]+l,{headers:r,mode:"cors",timeout:3e4}),await y(t)}catch(e){}c&&151==c.errorCode&&(F||v.removeItem(w),v.removeItem(A),u=K(),e.cu=u,h=void 0,l=encodeURIComponent(T(JSON.stringify(e))),t=await fetch(k[0]+"auth/?ext="+l,{headers:r,mode:"cors",timeout:3e4}),await y(t));(()=>{if(!t||!t.ok){let e;d&&v.setItem(A,""),c?111==c.errorCode?e=c.message:(e=c.message.trim(),e.endsWith(".")||(e+="."),e=o?`An error occurred during authorization: ${e} Contact the site administrator for more information.`:`An error occurred during authorization: ${e} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`):e=o?ee:Q;let t=Error(e);throw c&&c.errorCode&&(t.ltsErrorCode=c.errorCode),t}})();let g=await t.text();try{h||F||(v.setItem(w,await V(JSON.stringify([u,a]))),h=a),v.setItem(A,g)}catch(e){}return fetch(k[0]+"verify",{mode:"cors",method:"POST",headers:{"Content-Type":"application/json","lts-time":"options"},body:"[]",timeout:3e4}),g})(),new N(((e,t)=>{let r;r=o?Y:$,setTimeout((()=>t(new Error(r))),i?3e3:15e3)}))]);i=m}catch(t){r&&(e.dwt?self.console.error(t):console.error(t)),p=t}m=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),Z=null})()),await Z},oe=async()=>{U||(U=(async()=>{if(D(u),!i){if(!C)throw O(p.message),p;return}p&&B&&(B(p),B=null);let t={dm:c};r&&(t.bd=!0),t.brtk=!0,t.ls=k[0],o&&(t.hs=o),t.cu=u,f&&(t.fn=f),R&&(t.pd=R),s&&(t.dt=s),g&&(t.cw=g),l&&(t.os=JSON.stringify(l)),D(i);try{if(e.dwt)t.ar=i;else{let e=JSON.parse(await q(i));e.ba&&(t.ba=e.ba),e.usu&&(t.usu=e.usu),e.trial&&(t.trial=e.trial),e.its&&(t.its=e.its),1==t.trial&&e.msg?t.msg=e.msg:p?t.msg=p.message||p:e.msg&&(t.msg=e.msg),t.ar=e.in}t.bafc=!!p}catch(e){}D(t);try{await S(t)}catch(e){}await ie(),C||(C=!0),U=null})()),await U},ie=async()=>{let e=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),t=await _();if(D(t),t&&t<e)throw p?new Error(X):new Error(te)},se=!1,ce=new N((e=>{z=e})),ue=null,le=async(e,t)=>(I=I.then((async()=>{let r=!1;try{let n=await b.keys();if(t||(se?e&&(n=n.filter((t=>t<e))):e&&n.includes(e)?n=[e]:(n=[],D("Unexpected null key"))),!n.length)return;se||(r=!0,se=!0);for(let e=0;e<n.length/1e3;++e){let t=n.slice(1e3*e,1e3*(e+1)),a=[];for(let e=0;e<t.length;++e)a.push(await b.getItem(t[e]));let o=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");if(!F){v.setItem(w,await V(JSON.stringify([u,o])));let e=await v.getItem(w);e&&([u,h]=JSON.parse(await W(e)))}try{const e={"Content-Type":"application/json"};h&&!F&&(e["lts-time"]=h);let n=r?await new N(((t,r)=>{const n=new XMLHttpRequest;n.responseType="json",n.timeout=3e4,n.onload=()=>{t({ok:!0,json:()=>n.response})},n.onerror=n.timeout=n.onabort=()=>{t({ok:!1,status:n.status})},n.upload.onloadend=()=>{z()},n.open("POST",k[0]+"verify",!0);for(let t in e)n.setRequestHeader(t,e[t]);n.send(JSON.stringify(a))})):await fetch(k[0]+"verify",{mode:"cors",method:"POST",body:JSON.stringify(a),headers:e,timeout:3e4});if(!n.ok)throw new Error("verify failed. Status Code: "+n.status);h=o;for(let e=0;e<t.length;++e)await b.removeItem(t[e]);(await n.json()).handshakeUpdateTime>m&&(await ae(!0),await oe())}catch(e){throw B&&(B(e),B=null),e}}j&&j()}catch(e){}})),await I);return{i:async e=>(r=e.bd,n=e.version,a=n.split(".")[0],e.dt&&(s=e.dt),c=e.dm,o=e.lcs||"",l=e.browserInfo,f=e.deviceFriendlyName,e.ls&&e.ls.length&&(k=e.ls,1==k.length&&k.push(k[0])),d=e.sp,y=e.lm,g=e.cw,e.lf&&(E=e.lf),e.lsu&&(u=F=e.lsu),e.fdaa&&(q=e.fdaa),e.feab&&(G=e.feab),S=e.updateLicense,M=e.getMinExpireTime,_=e.getMaxExpireTime,e.sutlcb&&(j=e.sutlcb),await ne(),await ae(),await oe(),p||le(null,!0),{ar:i,cu:u}),c:async()=>{let e=new Date,t=e.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),r=await M(),n=await _();if(n&&n<t)await ae(!0),await oe();else if(r&&r<t){e.setMinutes(e.getMinutes()-6);let t=e;e=null;let r=t.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");h<r&&ae().then((()=>oe()))}},s:async(t,r,n,a)=>{if(!e.dwt||r){try{let e=r.startsWith("{")&&r.endsWith("}")?await G(r):r;e?await b.setItem(n,e):D("ept ecpt")}catch(e){}a&&await le(n),ue&&clearTimeout(ue),ue=setTimeout((async()=>{await le()}),36e4)}else await le(n)},caret:ie,pdsf:ce}};u=e({product:"dlr",log:k,debugLog:C}),self.scsd=u.s,m.updateLicense=b,m.getMinExpireTime=v,m.getMaxExpireTime=w,await u.i(m)}catch(e){if(!A)throw e;i=!1,await M(),g=e.ltsErrorCode,c=e.message||e}},M=async()=>{let e={pk:y,dm:t};r&&(e.bd=!0),await b(e)};i?await S():await M(),l.postMessage({type:"load",success:!0,version:Module[d].getVersion(),trial:s,ltsErrorCode:g,message:c})}catch(e){let t=e&&e.message;l.postMessage({type:"load",success:!1,ltsErrorCode:e&&e.ltsErrorCode,message:t,trial:s,stack:r&&e?e.stack:null})}break;case"createInstance":{const e=L++;try{let t=new Module[d](m.bScanner,e);t.currentCaffeModelName="NumberLetter",T.set(e,t)}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,instanceID:e}});break}case"destroy":try{if(!T.get(E))break;T.get(E).delete(),T.delete(E)}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"recognizeByBuffer":{let e,t,a,o,i=Date.now(),s=O.imageData.bytes;try{const i=T.get(E);await S(i.currentCaffeModelName,n),e=r?Date.now():0,D=O.imageData.bytes,(B=O.imageData.stride*O.imageData.height)>y&&(g&&Module._free(g),g=Module._malloc(B),y=B),Module.HEAPU8.set(D.subarray(0,B),g),O.imageData.bytes={ptr:g},t=r?Date.now():0,o=JSON.parse(i.recognizeByBuffer(JSON.stringify(O.imageData),O.config&&O.config.modelName||"",!(!O.config||!O.config.bScanner))),a=Date.now()}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,decodeReturn:o,buffer:s,duration:Date.now()-i}}),C(["timeWorkerGetMsg: "+i,"timeBeforeSendBufferToWasm: "+e+" "+(e-i),"timeBeforeDecode: "+t+" "+(t-e),"timeFinishDecode: "+a+" "+(a-t)].join("\n"));break}case"updateReferenceRegionFromBarcodeResults":{let e;try{e=JSON.parse(T.get(E).updateReferenceRegionFromBarcodeResults(JSON.stringify(O.dbrTextResults),""))}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,updateReturn:e}});break}case"clearMapDecodeRecord":try{T.get(E).clearMapDecodeRecord()}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"getRuntimeSettings":{let e;try{e=T.get(E).getRuntimeSettings()}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,results:e}});break}case"updateRuntimeSettings":{let e;try{const t=T.get(E),r=JSON.parse(O.settings).characterModelName;t.currentCaffeModelName=r,e=JSON.parse(t.updateRuntimeSettings(O.settings)),await S(r,n)}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,updateReturn:e}});break}case"resetRuntimeSettings":try{const e=T.get(E);e.currentCaffeModelName="NumberLetter",e.resetRuntimeSettings()}catch(e){I(t,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"appendSettingsFromString":{let e;try{e=JSON.parse(T.get(E).appendSettingsFromString(O.settings))}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,updateReturn:e}});break}case"clearAppendedSettings":try{T.get(E).clearAppendedSettings()}catch(e){I(t,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"updateRuntimeSettingsFromString":{let e;try{const t=T.get(E);let r=O.settings;if("string"==typeof r)if(r=r.trim(),r.startsWith("{"))r=JSON.parse(r);else{if(r.length>50)throw new Error("Error: preset longer than 50 letters.");const e=r.toLowerCase().split("-");if(e.length>2)throw new Error(`Error: '${r}' is not supported.`);if(t.resetRuntimeSettings(),r=JSON.parse(t.outputSettingsToString()),e.includes("numberletter"))(e=>{e.CharacterModelArray[0].Name="NumberLetter";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="NumberLetter",t.GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},t.LetterHeightRange[0]=5,t.LineStringLengthRange=[3,999],e.TextAreaArray[0].CharacterModelName="NumberLetter",e.TextAreaArray[0].GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},e.TextAreaArray[0].LetterHeightRange[0]=5,e.TextAreaArray[0].LineStringLengthRange=[3,999]})(r);else if(e.includes("number"))(e=>{e.CharacterModelArray[0].Name="Number";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="Number",t.GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},t.LetterHeightRange[0]=5,t.LineStringLengthRange=[3,999],e.TextAreaArray[0].CharacterModelName="Number",e.TextAreaArray[0].GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},e.TextAreaArray[0].LetterHeightRange[0]=5,e.TextAreaArray[0].LineStringLengthRange=[3,999]})(r);else if(e.includes("letter"))(e=>{e.CharacterModelArray[0].Name="Letter";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="Letter",t.GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},t.LetterHeightRange[0]=5,t.LineStringLengthRange=[3,999],e.TextAreaArray[0].CharacterModelName="Letter",e.TextAreaArray[0].GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},e.TextAreaArray[0].LetterHeightRange[0]=5,e.TextAreaArray[0].LineStringLengthRange=[3,999]})(r);else if(e.includes("numberuppercase"))(e=>{e.CharacterModelArray[0].Name="NumberUppercase";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="NumberUppercase",t.GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},t.LetterHeightRange[0]=5,t.LineStringLengthRange=[3,999],e.TextAreaArray[0].CharacterModelName="NumberUppercase",e.TextAreaArray[0].GrayscaleTransformationModes[0]={Mode:"GTM_AUTO"},e.TextAreaArray[0].LetterHeightRange[0]=5,e.TextAreaArray[0].LineStringLengthRange=[3,999]})(r);else if(e.includes("passportmrz"))(e=>{e.CharacterModelArray[0].Name="MRZ";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="MRZ",t.LetterHeightRange[0]=5,t.LineStringLengthRange=[44,44],t.LineStringRegExPattern=M,t.MaxLineCharacterSpacing=130,t.TextureDetectionModes[0].Sensitivity=8,e.LineSpecificationArray=[{Name:"L0",LineNumber:"",BinarizationModes:[{BlockSizeX:30,BlockSizeY:30,Mode:"BM_LOCAL_BLOCK"}]}],e.TextAreaArray[0].CharacterModelName="MRZ",e.TextAreaArray[0].LetterHeightRange[0]=5,e.TextAreaArray[0].LineStringLengthRange=[44,44],e.TextAreaArray[0].LineStringRegExPattern=M,e.TextAreaArray[0].MaxLineCharacterSpacing=130,e.TextAreaArray[0].TextureDetectionModes[0].Sensitivity=8,e.TextAreaArray[0].LineSpecificationNameArray=["L0"]})(r);else if(e.includes("visamrz"))(e=>{e.CharacterModelArray[0].Name="MRZ";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="MRZ",t.LetterHeightRange[0]=5,t.LineStringLengthRange=[36,44],t.LineStringRegExPattern=_,t.MaxLineCharacterSpacing=130,t.TextureDetectionModes[0].Sensitivity=8,e.LineSpecificationArray=[{Name:"L0",LineNumber:"",BinarizationModes:[{BlockSizeX:30,BlockSizeY:30,Mode:"BM_LOCAL_BLOCK"}]}],e.TextAreaArray[0].CharacterModelName="MRZ",e.TextAreaArray[0].LetterHeightRange[0]=5,e.TextAreaArray[0].LineStringLengthRange=[36,44],e.TextAreaArray[0].LineStringRegExPattern=_,e.TextAreaArray[0].MaxLineCharacterSpacing=130,e.TextAreaArray[0].TextureDetectionModes[0].Sensitivity=8,e.TextAreaArray[0].LineSpecificationNameArray=["L0"]})(r);else if(e.includes("mrz"))(e=>{e.CharacterModelArray[0].Name="MRZ";const t=e.LabelRecognizerParameterArray[0];t.CharacterModelName="MRZ",t.LetterHeightRange[0]=5,t.LineStringLengthRange=[30,44],t.LineStringRegExPattern=x,t.MaxLineCharacterSpacing=130,t.TextureDetectionModes[0].Sensitivity=8,e.LineSpecificationArray=[{Name:"L0",LineNumber:"",BinarizationModes:[{BlockSizeX:30,BlockSizeY:30,Mode:"BM_LOCAL_BLOCK"}]}],e.TextAreaArray[0].CharacterModelName="MRZ",e.TextAreaArray[0].LetterHeightRange[0]=5,e.TextAreaArray[0].LineStringLengthRange=[30,44],e.TextAreaArray[0].LineStringRegExPattern=x,e.TextAreaArray[0].MaxLineCharacterSpacing=130,e.TextAreaArray[0].TextureDetectionModes[0].Sensitivity=8,e.TextAreaArray[0].LineSpecificationNameArray=["L0"]})(r);else if(e.includes("vin"))N(r);else if(e.includes("vin_na"))N(r);else if(!e.includes("cppdefault"))throw new Error(`Error: '${r}' is not supported.`);e.includes("video")&&(e=>{const t=e.LabelRecognizerParameterArray[0];"VIN"===e.CharacterModelArray[0].Name&&(t.LineStringLengthRange=[14,25],e.TextAreaArray[0].LineStringLengthRange=[14,25]);let r=10*t.LetterHeightRange[0];const n=Math.max(500,t.LetterHeightRange[0]);r>=n&&(r=n),t.LetterHeightRange[0]=r,e.TextAreaArray[0].LetterHeightRange[0]=r})(r)}const a=r.CharacterModelArray[0].Name;t.currentCaffeModelName=a,e=JSON.parse(t.updateRuntimeSettingsFromString(JSON.stringify(r))),await S(a,n)}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,updateReturn:e}});break}case"outputSettingsToString":{let e;try{e=T.get(E).outputSettingsToString()}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,results:e}});break}case"appendCaffeModelBuffer":try{await S(O.name,O.folderUrl)}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"eraseCaffeModelByName":try{Module[d].eraseCaffeModelByName(O.name),delete A[O.name]}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"eraseAllCaffeModels":try{Module[d].eraseAllCaffeModels(),A={}}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"setModeArgument":{let e;try{e=JSON.parse(T.get(E).setModeArgument(O.modeName,O.index,O.argumentName,O.argumentValue))}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,setReturn:e}});break}case"getModeArgument":{let e;try{e=JSON.parse(T.get(E).getModeArgument(O.modeName,O.index,O.argumentName))}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,getReturn:e}});break}case"updateScanSettings":try{let e=T.get(E),t=O.settings;e.duplicateForgetTime=t.duplicateForgetTime,e.rememberFrameCount=t.rememberFrameCount,e.trustFrameCount=t.trustFrameCount}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0}});break;case"getScanSettings":{let e={};try{let t=T.get(E);e.duplicateForgetTime=t.duplicateForgetTime,e.rememberFrameCount=t.rememberFrameCount,e.trustFrameCount=t.trustFrameCount}catch(e){I(e,R);break}l.postMessage({type:"task",id:R,body:{success:!0,results:e}});break}default:console.warn("Unmatched task: ",t)}var D,B};e?l.on("message",R):l.onmessage=R;let k=e=>{l.postMessage({type:"log",message:e})},C=e=>{r&&k(e)},I=(e,t)=>{l.postMessage({type:"task",id:t,body:{success:!1,message:e.message,stack:e.stack}}),setTimeout((()=>{throw e}),0)}})()}();
